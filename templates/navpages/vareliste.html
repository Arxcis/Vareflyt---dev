{% include 'header.html'%}

<section id="bestillingskort" class="col-md-12">
  <h3> Bestillingskort </h3>
  <form class="form-horizontal">
    <fieldset>
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-1 control-label" for="textinput">Navn</label>  
          <div class="col-md-5">
            <input id="inputnavn" name="textinput" type="text" placeholder="Fornavn og Etternavn" class="form-control input-md" required="">
    
          </div>
          <label class="col-md-1 control-label" for="textinput">Telefon</label>  
          <div class="col-md-2">
            <input id="inputtelefon" name="inputtelefon" type="text" placeholder="8 siffer" class="form-control input-md" required="">
    
          </div>
      </div>
    
    </fieldset>
  </form>

  <table class="table">
    <thead>
        <tr style="background-color: #70db70;">
          <th class="col-md-1">VareID</th>
          <th class="col-md-1">Merke</th>
          <th class="col-md-3">Modell</th>
          <th class="col-md-1">Antall</th>
          <th class="col-md-2 col-md-offset-1">Pris</th>   
        </tr>
      </thead>
     <tbody id="bestillingstabell">
        <!-- JAVASCRIPT goes here-->
     </tbody> 
  </table>
  <div class="row col-md-4 col-md-offset-9" style="margin-bottom: 10pt;">
    <div class="col-md-2">
        <p id="prislapp">0 ,-</p>
    </div>
    <form class="form-horizontal">
        <div class="col-md-2">
          <button id="bestillsubmit" name="bestillsubmit" class="btn btn-success">BESTILL</button>
        </div>
    </form>
  </div>
</section>


<section id="varetabellkort" class="col-md-12">
  <h3>Varetabell</h3>

  <form class="form-horizontal">
      <!-- Search input-->
      <div class="form-group">
        <label class="col-md-1 control-label" for="searchinput">SÃ¸k</label>
        <div class="col-md-6">
          <input id="searchvare" name="searchvare" type="search" placeholder="" class="form-control input-md">
    
        </div>
      </div>
  </form>

    <table class="table">
      <thead>
        <tr style="background-color: #70db70;">
          <th class="col-md-1">Artnr</th>
          <th class="col-md-1">Merke</th>
          <th class="col-md-4">Modell</th>
          <th class="col-md-2">Utsalgspris</th>   
        </tr>
      </thead>
      <tbody id= "varetabell">
          <!-- javascript- id="tabelllinjer" runs here-->
      </tbody>
    </table>
</section>


<script type="text/javascript" language="javascript">

    varelinjer = new Array();
    prislinjer = new Object();
    total_verdi = 0; 


    function sumBestilling(vareID, pris, antall) {

      prislinjer[String(vareID)] = new Array(parseInt(pris), parseInt(antall));

      console.log(prislinjer);
      total_verdi = 0;
      for (var key in prislinjer) {

        total_verdi += (prislinjer[key][0] * prislinjer[key][1]); 
      };
      console.log(total_verdi + "kroner");

      $("#prislapp").text(String(total_verdi) + ",-");

    }

    function AddVare(vareID) {
      

      $.getJSON('/getvarelinje?ID=' + vareID, function(data){
        var nylinje = [];
        /* FORMAT INCOMMING JSON-STRING*/
        nylinje = data.row.split(",");

        var row_ID = nylinje[0];
        var stykkpris = nylinje[3];
        
        

        if ($.inArray(row_ID, varelinjer) != -1) {
            return 0;

        } else {
          $('#bestillingstabell').append('<tr id="' + row_ID +'">' + '</tr>');

            for (i=0; i < nylinje.length; i++) {
              switch(i) {
                case 0:
                    $('#' + row_ID).append('<td>' + nylinje[i] + '</td>');
                    break;
                case 1:
                    $('#' + row_ID).append('<td>' + nylinje[i] + '</td>');
                    break;
                case 2:
                    $('#' + row_ID).append('<td>' + nylinje[i] + '</td>');
                    break;
                case 3:
                    $('#' + row_ID).append('<td><form class="form-horizontal">' +
                                             '<select name="selectbasic" class="form-control"' +
                                             ' onchange="sumBestilling(' + row_ID + ',' + stykkpris + ',this.value)"">' +
                                              '<option value="1">1</option>' + 
                                              '<option value="2">2</option>' +
                                              '<option value="3">3</option>' +
                                              '<option value="4">4</option>' +
                                              '<option value="5">5</option>' +
                                              '<option value="6">6</option>' +
                                              '<option value="7">7</option>' +
                                              '<option value="8">8</option>' +
                                              '<option value="9">9</option>' +
                                              '<option value="10">10</option>' +
                                             '</select>' +
                                           '</form></td>')
                    break;
                case 4:
                    console.log(nylinje[i-1]);
                    $('#' + row_ID).append('<td>' + String(nylinje[i-1]) + ' ,-</td>');
                    break;
              
                  
                
              };
            };
          varelinjer.push(row_ID);
          sumBestilling(row_ID, stykkpris, 1);
        };
      });
    };
</script>

<script type=text/javascript language="javascript">
    $(document).ready(function() {

        $.getJSON('/getvareutvalg', function(data) {
          var inc_string = data.liste;
          var liste = inc_string.split(",");
          var bryter = 0;
          var div_id = '';

          for (i=0; i < liste.length; i++) {

            switch(bryter) {
              case 0:
                  div_id = liste[i];
                  div_id = $.trim(div_id);
                  $('#varetabell').append('<tr class=\'eventlinje\' id=\'' + div_id + '\' onClick=\'AddVare(this.id)\'>' + '</tr>');
                  bryter = 1;
                  break;

              case 1:
                  $('#' + div_id).append('<td>' + liste[i] + '</td>');
                  bryter = 2;
                  break;

              case 2:
                  $('#' + div_id).append('<td>' + liste[i] + '</td>');
                  bryter = 3;
                  break;

              case 3:
                  $('#' + div_id).append('<td>' + liste[i] + '</td>');

                  bryter = 4;
                  break;

              case 4:
                  $('#' + div_id).append('<td>' + liste[i] + ' kr' + '</td>');
                  bryter = 0;
                  break;

            };
          };

      });
      /*var linjeID = '';
      $('.eventlinje').onClick( function() {
          linjeID = $('this').attr('id');
          AddVare(linjeID);
      });*/
    }); 
</script>

{% include 'footer.html' %}